<!doctype html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="description" content="NousSense Lab â€” interfaz natural con reconocimiento de voz, sÃ­ntesis de habla y visiÃ³n por cÃ¡mara con MediaPipe.">
  <meta name="theme-color" content="#2f3437">
  <title>NousSense Lab Â· Voz y CÃ¡mara</title>
  <link rel="stylesheet" href="assets/styles.css">
  <script src="https://cdn.jsdelivr.net/npm/@mediapipe/hands/hands.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/@mediapipe/face_mesh/face_mesh.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/@mediapipe/drawing_utils/drawing_utils.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/@mediapipe/camera_utils/camera_utils.js"></script>
</head>
<body>
  <main class="shell">
    <!-- Header -->
    <section class="panel header">
      <div class="header-left">
        <h1>ğŸ™ï¸ NousSense Lab</h1>
        <p>Interfaz natural: voz + sÃ­ntesis + cÃ¡mara con detecciÃ³n de manos/cara y persistencia en IndexedDB.</p>
      </div>
      <div class="header-right">
        <div id="assistantState" class="badge badge-idle"><span class="badge-dot"></span> Asistente inactivo</div>
        <button id="darkModeBtn" class="icon-btn" aria-label="Alternar modo oscuro">ğŸŒ™</button>
      </div>
    </section>

    <!-- KPI bar -->
    <section class="kpi-bar">
      <div class="kpi kpi-blue"><span id="kpiVoice">0</span> Comandos voz</div>
      <div class="kpi kpi-green"><span id="kpiNotes">0</span> Notas</div>
      <div class="kpi kpi-amber"><span id="kpiCaptures">0</span> Capturas</div>
      <div class="kpi kpi-red"><span id="kpiEvents">0</span> Eventos</div>
    </section>

    <!-- Tabs -->
    <nav class="tabs">
      <button class="tab active" data-tab="main">Principal</button>
      <button class="tab" data-tab="history">Historial</button>
      <button class="tab" data-tab="commands">Comandos</button>
    </nav>

    <!-- Tab: Principal -->
    <div id="tab-main" class="tab-content active">
      <section class="grid-two">
        <article class="panel">
          <h2>Control de voz</h2>
          <div class="actions">
            <button id="listenBtn" aria-label="Iniciar reconocimiento de voz">ğŸ™ï¸ Escuchar</button>
            <button id="stopListenBtn" class="secondary" aria-label="Detener reconocimiento de voz">Detener</button>
          </div>
          <canvas id="waveformCanvas" width="400" height="60"></canvas>
          <div id="confidenceBar" class="confidence-bar" hidden>
            <div class="confidence-fill" id="confidenceFill"></div>
            <span id="confidenceLabel">0%</span>
          </div>
          <label>Texto reconocido
            <textarea id="recognizedText" rows="3" placeholder="AquÃ­ aparecerÃ¡ la frase reconocida..."></textarea>
          </label>
          <label>Respuesta hablada
            <input id="speakText" placeholder="Escribe y pulsa hablar o usa comandos de voz">
          </label>
          <div class="actions">
            <button id="speakBtn" class="secondary" aria-label="Sintetizar texto a voz">ğŸ”Š Hablar</button>
            <button id="stopSpeakBtn" class="secondary" aria-label="Silenciar sÃ­ntesis de voz">Silenciar</button>
          </div>
        </article>

        <article class="panel">
          <h2>VisiÃ³n por cÃ¡mara</h2>
          <div class="actions">
            <button id="startCamBtn" aria-label="Iniciar cÃ¡mara">ğŸ“· Iniciar cÃ¡mara</button>
            <button id="stopCamBtn" class="secondary" aria-label="Apagar cÃ¡mara">Apagar cÃ¡mara</button>
            <button id="captureBtn" class="secondary" aria-label="Capturar imagen">ğŸ“¸ Capturar</button>
          </div>
          <div class="row">
            <label>Modo de detecciÃ³n
              <select id="modeSelect">
                <option value="none">Normal</option>
                <option value="hands">Manos</option>
                <option value="face">Cara</option>
              </select>
            </label>
            <label>Ãšltimo estado
              <input id="visionStatus" readonly value="Sin iniciar">
            </label>
          </div>
          <div class="camera-wrapper">
            <video id="inputVideo" autoplay playsinline muted hidden></video>
            <canvas id="outputCanvas" width="640" height="480"></canvas>
            <div id="cameraPlaceholder" class="camera-placeholder">ğŸ“· Pulsa "Iniciar cÃ¡mara" para comenzar</div>
            <div id="cameraOverlay" class="camera-overlay" hidden>
              <span class="live-dot">â— LIVE</span>
              <span id="overlayMode">Normal</span>
              <span id="overlayFps">0 FPS</span>
            </div>
          </div>
        </article>
      </section>

      <section class="grid-two">
        <article class="panel">
          <h2>Notas y memoria (IndexedDB)</h2>
          <div class="actions">
            <button id="reloadDataBtn" class="secondary">Recargar</button>
            <button id="exportNotesBtn" class="secondary" aria-label="Exportar notas">â¬‡ Exportar</button>
            <button id="clearNotesBtn" class="secondary">Vaciar notas</button>
          </div>
          <div id="notesList" class="list"></div>
        </article>

        <article class="panel">
          <h2>Capturas guardadas</h2>
          <div id="capturesGrid" class="captures"></div>
        </article>
      </section>
    </div>

    <!-- Tab: Historial -->
    <div id="tab-history" class="tab-content">
      <section class="panel">
        <div class="actions">
          <button id="clearHistoryBtn" class="secondary">Vaciar historial</button>
        </div>
        <div id="historyList" class="list list-tall"></div>
      </section>
    </div>

    <!-- Tab: Comandos -->
    <div id="tab-commands" class="tab-content">
      <section class="panel">
        <h2>Referencia rÃ¡pida de comandos de voz</h2>
        <table class="commands-table">
          <thead><tr><th>Comando</th><th>AcciÃ³n</th></tr></thead>
          <tbody>
            <tr><td><code>modo manos</code></td><td>Activa detecciÃ³n de manos</td></tr>
            <tr><td><code>modo cara</code></td><td>Activa detecciÃ³n facial</td></tr>
            <tr><td><code>modo normal</code></td><td>Desactiva detecciÃ³n</td></tr>
            <tr><td><code>iniciar cÃ¡mara</code></td><td>Enciende la cÃ¡mara</td></tr>
            <tr><td><code>detener cÃ¡mara</code></td><td>Apaga la cÃ¡mara</td></tr>
            <tr><td><code>capturar</code></td><td>Guarda snapshot en IndexedDB</td></tr>
            <tr><td><code>guardar nota ...</code></td><td>Guarda nota de texto dictada</td></tr>
            <tr><td><code>leer notas</code></td><td>Lee la Ãºltima nota en voz alta</td></tr>
            <tr><td><code>eliminar notas</code></td><td>Borra todas las notas</td></tr>
          </tbody>
        </table>
      </section>
    </div>

    <!-- Footer -->
    <footer class="footer">
      NousSense Lab Â· DAM2 â€” Desarrollo de interfaces Â· 2026
    </footer>
  </main>

  <!-- Toast container -->
  <div id="toastContainer" class="toast-container"></div>

  <!-- Custom confirm overlay -->
  <div id="confirmOverlay" class="confirm-overlay" hidden>
    <div class="confirm-dialog">
      <h3 id="confirmTitle">Confirmar</h3>
      <p id="confirmMessage">Â¿EstÃ¡s seguro?</p>
      <div class="actions">
        <button id="confirmOk">Aceptar</button>
        <button id="confirmCancel" class="secondary">Cancelar</button>
      </div>
    </div>
  </div>

  <script type="module" src="assets/app.js"></script>
  <noscript><p style="text-align:center;padding:2rem;">NousSense Lab requiere JavaScript habilitado.</p></noscript>
</body>
</html>
